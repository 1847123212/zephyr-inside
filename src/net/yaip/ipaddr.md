---
title: Zephys OS yaip 协议栈：IP 地址
date: 2016-10-19 20:21:14
categories: ["Zephyr OS"]
tags: [Zephyr]
---

IP 的全称是 Internet Protocol，即因特网协议。目前，IP 协议有两个版本：IPv4 和 IPv6。我们将重点放到 IPv6 上，主要包括如下原因：
- 我们对 IPv4 或多或少都有了解，比如知道 IPv4 的地址形式是 `192.168.1.137` 等，但是我们很少了解 IPv6。
- 由于 IPv4 的地址已被耗尽，对于物联网来说，需要大量的 IP 地址，所以 IPv6 才是今后的趋势。

# 理论部分
## IPv6 的接口
IPv6 中有一个非常基础的概念，接口(interface)。我们可以简单地理解为一个接口就是对应一个网卡(包括以太网卡、WiFi网卡、802.15.4 芯片、蓝牙芯片)。
## IPv6 的地址形式
IPv6 地址是网络层中由于描述接口和接口组的标识符。IPv6 地址的一般的表示方法是 `2001:DB8:0:0:8:800:200C:417A `。它的主要特征：
- 由 8 组组成，每组有符号“:”隔开；
- 每组由四个十六进制符号组成；
- 一共占 8\*(4\*4) = 128 位；

IPv6 的地址还可以被简写，具体信息请参考后面的[*参考资料*](#参考资料)一节。

## IPv6 地址的分类
IPv6 的地址可以分为三类：
- 单播地址：单一接口的标识符。发送到单播地址的报文被交付给由该地址标识的接口。
- 任播地址：一组接口(通常属于不同节点)的标识符。发送到任播地址的报文被交付给由该地址标识的接口组中的一个接口(最近的接口，这里的最近是按照路由协议测量出来的)。
- 多播(组播)地址：一组接口(通常属于不同节点)的标识符。发送到多播地址的报文被交付给由该地址标识的所有接口。

## IPv6 地址的范围(Scope)
- 全球(global)范围：
- 链路本地(link-local)范围：

## IPv6 地址的组成
我们已经知道，IPv6 的地址一个占 128 比特，我们可以将其拆分成两截：
- 前面 64 比特：被叫做前缀。 根据 IPv6 地址的范围，我们可以进一步划分：
   - 链路本地前缀
   - 全球前缀
- 后面 64 比特：被叫做接口标识符(IID)。

> 还有一些特殊情况，前缀占 n 比特，接口标识符占 128 - n 比特。请参考《RFC4921》。

# 代码部分
